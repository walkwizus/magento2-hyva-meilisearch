<?php

declare(strict_types=1);

use Magento\Framework\View\Element\Template;
use Magento\Framework\Escaper;

/**
 * @var Template $block
 * @var Escaper $escaper
 */
$alias = (string) $block->getData('alias');
?>
<div class="flex flex-col gap-2">
    <div class="flex justify-start px-2">
        <span
            class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-[11px] font-medium text-gray-700"
            x-text="
                (store.autocomplete.results['<?= $escaper->escapeJs($alias) ?>']
                    ? store.autocomplete.results['<?= $escaper->escapeJs($alias) ?>'].length
                    : 0
                ) + ' results'
            "
        ></span>
    </div>
    <div class="grid grid-cols-2 gap-2">
        <template
            x-for="hit in store.autocomplete.results['<?= $escaper->escapeJs($alias) ?>']"
            :key="hit.id"
        >
            <a
                data-autocomplete-item
                class="flex flex-col gap-2 p-2 rounded-lg border border-gray-100 hover:border-gray-200 hover:bg-gray-50 focus:bg-gray-50 focus:outline-none cursor-pointer"
                :href="store.getProductUrl(hit.url_key)"
                @click="store.closeAutocomplete()"
                @keydown.enter.prevent="$event.target.click()"
            >
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gray-100 overflow-hidden flex items-center justify-center shrink-0">
                        <template x-if="hit.image">
                            <img
                                class="w-full h-full object-cover"
                                :src="store.getAutocompleteImage(hit)"
                                :alt="hit.name || ''"
                                loading="lazy"
                            >
                        </template>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div
                            class="text-sm font-medium text-gray-900 line-clamp-1"
                            x-html="store.highlightAutocomplete(hit.name || '')"
                        ></div>
                        <div
                            class="mt-0.5 text-xs text-gray-500 line-clamp-1"
                            x-text="hit.sku"
                        ></div>
                    </div>
                </div>
                <div
                    class="text-sm font-semibold text-gray-900"
                    x-show="hit.price_0 !== undefined"
                >
                    <span x-text="new Intl.NumberFormat('fr-FR', {
                        style: 'currency',
                        currency: 'EUR'
                    }).format(hit.price_0)"></span>
                </div>
            </a>
        </template>
    </div>
</div>
